# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is `@hsna/prompt`, a CLI tool that generates optimized prompts for AI assistants (Claude, Cursor, ChatGPT) to write frontend tests. It automates context gathering for test generation through an ATDD (Acceptance Test Driven Development) workflow.

## Common Commands

```bash
# Development
npm run dev              # Run with tsx (hot reload)
npm run build            # Build to dist/ (includes copying prompt .md files)
npm link                 # Link locally for testing CLI commands

# Testing
npm test                 # Run all tests with vitest
npm run test:watch       # Watch mode
vitest run src/core/prompt.test.ts  # Run specific test file

# Code Quality
npm run lint             # ESLint check
npm run lint:fix         # Auto-fix lint issues
npm run format           # Prettier format
```

## Architecture

### CLI Commands (src/commands/)
Each command corresponds to a step in the ATDD workflow:
- `init` - Generates project analysis prompt, creates `project-test-lessons.md`
- `atdd` - Generates acceptance test scenario design prompt
- `plan` - Generates test routing (unit vs UI vs E2E) plan prompt
- `gen` - Generates test implementation prompt (--type ui|unit)
- `learn` - Runs tests and generates feedback analysis prompt for failures

### Core Logic (src/core/)
- `prompt.ts` - Prompt generation functions (generateAtddPrompt, generatePlanPrompt, generateGenPrompt, generateLearnPrompt)
- `locator.ts` - File discovery logic for ATDD/Plan/Test files based on `project-manifest.yaml` configuration
- `runner.ts` - Test execution wrapper using child_process
- `setup.ts` - Initial setup (creates lessons file)
- `test-type.ts` - Test type enum and template mapping

### Prompt Templates (src/prompts/*.md)
Markdown templates with `{{PLACEHOLDER}}` syntax for variable substitution. Copied to dist/ during build.

### Key Configuration Files (in target projects)
- `project-manifest.yaml` - Project configuration generated by AI after `init` command
- `project-test-lessons.md` - AI-maintained "lessons learned" from test failures

## Key Patterns

- ESM modules with `.js` extension in imports (TypeScript compiles to ESM)
- Commands use commander.js and copy results to clipboard via clipboardy
- File paths with special characters (parentheses, spaces) require quote handling
- Test file discovery checks both co-location and configured `testPaths.dirName` directory
